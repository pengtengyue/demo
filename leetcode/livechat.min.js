function liveChat_Config() {
	this.routers = {};
	this.currentURL = '';
	this.config = {
		isDefaultScript: false,
		issavecustomer: true,
		isautoscore: true,
		iscustomized: true,
		enabledLayer: false,
		brand: 'PCCC',
		skillgroup: '14049',
		frommedia: '',
		staticURL: '',
		apiURL: '',
		wsURL: '',
		cookie_domain: '',
		document_domain: '',
		version: '0.112345',
		automatic: false,
		automatictime: 60000,
		ispro: false //false测试
	}
	this.worktime = [9, 24];
	this.logging_active = (typeof this.logging_active === 'undefined') ? true : false;
	this.uat_uri = {
		'staticURL': {'http:': '', 'https:': 'https://servicelite.porsche-scrm-engagement.com/livechat/'},
		'apiURL': {'http:': '', 'https:': 'https://servicelite.porsche-scrm-engagement.com/livechat/'},
		'wsURL': {'http:': '', 'https:': 'wss://servicelite.porsche-scrm-engagement.com/'}
	};
	this.uri = {
		'staticURL': {'http:': '', 'https:': 'https://service.porsche-scrm-engagement.com/livechat/'},
		'apiURL': {'http:': '', 'https:': 'https://service.porsche-scrm-engagement.com/livechat/'},
		'wsURL': {'http:': '', 'https:': 'wss://service.porsche-scrm-engagement.com/'}
	}
	this.autoPathList = {
		'pattern': ["china/zh/", "china/zh/models/", "china/zh/modelstart/"],
		'domains': [],
		'path': []
	}
	this.whiteList = {
		'pattern': ["china/zh/models/"],
		'domains': ["servicelite.porsche-scrm-engagement.com", "test.porschecn-events.cn", "porschelaunch.porschecn-events.cn","porschefinance.porschecn-events.cn","cayennephev.porschecn-events.cn","store-dev.porsche-preview.cn","store-staging.porsche-preview.cn","store-ppd.porsche-preview.cn","store.porsche.cn"],
		'path': []
	};
	this.absoluteWhiteList = {
		'pattern': [],
		'domains': [],
		'path': ["/china/zh/", "/china/zh/modelstart/",  "/china/zh/modelstart/all/"]
	};
	//LC Boldseas Site
	this.whiteListBoldseas= {
		'pattern': [],
		'domains': ["porsche-shop.boldseas.com"],
		'path': []
	};
	//LC Preorder Site
	this.whiteListPreorder= {
		'pattern': ["porsche-online-preorder.com.cn"],
		'domains': [],
		'path': []
	};
	//identify specific models
	this.configModelWhiteList = {
		'pattern': [],
		'domains': [],
		'path': []
	};
	//identify specific models
	this.configWhiteListModelYear = {
		'pattern': [],
		'domains': [],
		'path': []
	};
	//identify specific UserID
	this.whiteListUserId = {
		'pattern': ['userID=PCN'],
		'domains': [],
		'path': []
	};
	//identify specific Lang
	this.whiteListLang = {
		'pattern': ['lang=cn'],
		'domains': [],
		'path': []
	};

	var appfrom = this.getParam('frommedia');

	this.config.appfrom = appfrom;
	this.setCookie('appfrom',appfrom, null, null);

	if(this.getParam('ocslcqa') === 'pcn1') {
		this.config.ispro = false;
		this.setCookie('ocslcqa','pcn1', null, null);
	}

	var uriKey = document.location.protocol;
	this.config.staticURL = this.config.ispro ? this.uri.staticURL[uriKey] : this.uat_uri.staticURL[uriKey];
	this.config.apiURL = this.config.ispro ? this.uri.apiURL[uriKey] : this.uat_uri.apiURL[uriKey];
	this.config.wsURL = this.config.ispro ? this.uri.wsURL[uriKey] : this.uat_uri.wsURL[uriKey];
	var ua = navigator.userAgent.toLowerCase();
	return true;
}

liveChat_Config.prototype.isLoader = function (starttime, endtime) {
	var now = new Date();
	var hour = now.getHours();
	if (hour >= starttime && hour <= endtime) {
		return true;
	}
	return false;
}

liveChat_Config.prototype.getNavLanguage = function () {
	var url = window.location.href;
	if (navigator.appName == "Netscape") {
		if (url.indexOf('hk') > 0 || navigator.language == 'zh-HK' || navigator.language == 'zh-TW') {
			return 'zh-HK';
		} else if (navigator.language == 'zh-CN') {
			return 'zh-CN';
		} else {
			return navigator.language;
		}
	}
}

liveChat_Config.prototype.list = function (obj) {
	try {
		var i = 0;
		var currentPath = window.location.pathname.toLowerCase();
		var currentURL = document.URL.toLowerCase();
		var currentDomain = document.URL.substring(document.URL.indexOf('//')+2, document.URL.indexOf('/', document.URL.indexOf('//')+2));
		currentDomain = currentDomain.toLowerCase();
		for (i = 0; i < obj.pattern.length; i = i + 1) {
			if (currentURL.indexOf(obj.pattern[i].toLowerCase()) !== -1) {
				return true;
			}
		}
		for (var i = 0; i < obj.domains.length; i = i + 1) {
			if (currentDomain === obj.domains[i].toLowerCase()) {
				return true;
			}
		}
		for (i = 0; i < obj.path.length; i = i + 1) {
			if (currentPath === obj.path[i].toLowerCase()) {
				return true;
			}
		}
		return false;
	} catch (err){
		return false;
	}
}

liveChat_Config.prototype.setCookie = function (c_name, c_text, exdays, c_domain) {
	try{
		var  t_value = '', t_expires = '', exdate = new Date(), t_domain = '';
		if (exdays) {
			exdate.setDate(exdate.getDate() + exdays);
			t_expires = '; expires=' + exdate.toUTCString();
		}
		if (c_domain) {
			t_domain = '; domain=' + c_domain;
		}
		t_value = encodeURIComponent(c_text) +  t_expires + '; path=/' + t_domain;
		document.cookie = c_name + '=' + t_value;
	} catch(e){}
}

liveChat_Config.prototype.getCookie = function (c_name) {
	try{
		var searchname = c_name + '=';
		var ca = document.cookie;
		var c = "";
		var i = 0;
		ca = ca.split(';');
		for (i = 0; i < ca.length; i = i + 1) {
			c = ca[i];
			while (c.charAt(0) === ' ') {c = c.substring(1, c.length); }
			if (c.indexOf(searchname) === 0) {return decodeURIComponent(c.substring(searchname.length, c.length)); }
		}
		return 'undefined';
	} catch(e){
		return 'undefined';
	}
}

liveChat_Config.prototype.init = function () {
	var options = this.config;

	console.log('livechat init.');
	var enabled = this.getParam('enabled');
	var frommedia = this.getParam('frommedia');
	console.log('livechat frommedia:' + frommedia)

	var that = this;
	var isloader = false;
	this.config.frommedia = frommedia;
	if (this.config.ispro) {
		isloader = true;
	} else {
		if (this.getCookie('ocslcqa') === 'pcn1' || enabled === 'true') {
			isloader = true;
		}
	}
	if (top.location != location)  isloader = false;

	var xhr = null;
	if (window.XMLHttpRequest) {
		xhr = new XMLHttpRequest();
	} else {
		xhr = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xhr.open("get", this.config.apiURL + "chat/getServerTime", "true");
	xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

	xhr.send(null);
	xhr.onreadystatechange = function () {
		if (xhr.readyState === 4) {
			if (xhr.status >= 200 && xhr.status < 300 || xhr.status == 304) {
				var now = new Date(parseInt(xhr.response));
				console.info(now )
				var isWorkTime = false;

				if (that.worktime[0] <= now.getHours() && now.getHours() < that.worktime[1]) {
					isWorkTime = true;
				}

				var inWhiteList = false;
				if ((document.domain === "cc.porsche.com" || document.domain === "cc.porsche.cn")) {
					if (that.list(that.whiteListUserId) && that.list(that.whiteListLang)) {
						inWhiteList = true;
					}
				} else {
					if (that.list(that.absoluteWhiteList)) {
						inWhiteList = true;
					} else {
						inWhiteList = that.list(that.whiteList);
					}

				}

				var inBlacklist = false;
				try {

					var xhr2 = null;
					if (window.XMLHttpRequest) {
						xhr2 = new XMLHttpRequest();
					} else {
						xhr2 = new ActiveXObject("Microsoft.XMLHTTP");
					}
					xhr2.open("get", that.config.apiURL + "chat/" + that.config.brand + "/web/isblacklist", "true");
					xhr2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

					xhr2.send(null);
					xhr2.onreadystatechange = function () {
						if (xhr2.readyState === 4) {
							if (xhr2.status >= 200 && xhr2.status < 300 || xhr2.status == 304) {

								if (xhr2.response == 'false') {
									if (isloader && isWorkTime && inWhiteList) {
										that.config.language = that.getNavLanguage();
										that.config.automatic = that.list(that.autoPathList);
										that.loadScript(that.config.staticURL + 'chatapp/customer/js/' + that.config.brand + '/website_14049/livechat.js?' + Math.random(), function () {
											new Livechat({ "options" : that.config }).intializate();
										});
									}
								}
							}
						}
					}
				} catch(e) {
					if (isloader && isWorkTime && inWhiteList) {
						that.config.language = that.getNavLanguage();
						that.config.automatic = that.list(that.autoPathList);
						that.loadScript(that.config.staticURL + 'chatapp/customer/js/' + that.config.brand + '/website_14049/livechat.js?' + Math.random(), function () {
							new Livechat({ "options" : that.config }).intializate();
						});
					}
				}
			}
		}
	}
}

liveChat_Config.prototype.getParam = function (_key) {
	var qsParm = [];
	var query = window.location.search.substring(1);
	var parms = query.split('&');
	var i = 0, pos =0, key = '', val = '', retval = '';
	for (i = 0; i < parms.length; i = i + 1) {
		pos = parms[i].indexOf('=');
		if (pos > 0) {
			key = parms[i].substring(0, pos);
			val = parms[i].substring(pos + 1);
			qsParm[key] = val;
		}
	}
	retval = (typeof qsParm[_key] !== 'undefined') ? qsParm[_key] : '';
	return retval;
}

liveChat_Config.prototype.loadScript = function (url, callback) {
	var script = document.createElement("script");
	var scriptLst = document.getElementsByTagName("script")[0];
	try {
		script.type = "text/javascript";
		if (script.readyState) {
			script.onreadystatechange = function () {
				if (script.readyState == "loaded" || script.readyState == "complete") {
					script.onreadystatechange = null;
					callback();
				}
			};
		} else {
			script.onload = function () {
				callback();
			};
		}
		script.src = url;
		scriptLst.parentNode.insertBefore(script, scriptLst);
	} catch (e) {console.info(e) }
}

try {
	new liveChat_Config().init();
} catch (e) {console.info(e)}